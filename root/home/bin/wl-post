#!/bin/sh
# Post startup script for wayland compositors

# Log dir should be created from wl script
log_dir=$HOME/tmp/logs

# Dbus (atleast with elogind) doesn't get updated environment variables causing
# some applications (like mako) to not autostart.
dbus-update-activation-environment --all > "$log_dir/dbus-env-update" 2>&1 &

# Do this if pipewire is not already running
pgrep -x 'pipewire' || {
	# Start pipewire in the background and wait a second
	pipewire > "$log_dir/pipewire" 2>&1 &
	sleep 1

	# Create a null sink to easily run all audio through an equalizer
	pactl load-module module-null-sink sink_name=NullDefaultSink > "$log_dir/null-sink" 2>&1
	pactl set-default-sink NullDefaultSink >> "$log_dir/null-sink" 2>&1

	# Create a null sink to easily noise suppress microphone output
	pactl load-module module-null-sink sink_name=NullDefaultSource channels=1 > "$log_dir/null-source" 2>&1
	pactl set-default-source NullDefaultSource.monitor >> "$log_dir/null-source" 2>&1
} &

# Start the foot-server
foot -s > "$log_dir/foot-server" 2>&1 &

## Start Carla without gui
#pgrep -x 'carla' || { carla -n "${HOME}/cfg/carla/desktop.carxp" > "$log_dir/carla" 2>&1 & } &
