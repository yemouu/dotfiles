#!/bin/sh
# Script to start pipewire with extra sinks and sources

# Log dir should be created from wl script
log_dir=$HOME/tmp/logs

# Do this if pipewire is not already running
pgrep -x 'pipewire' || {
	# Start pipewire in the background and wait a second
	pipewire > "$log_dir/pipewire" 2>&1 &
	sleep 1

	[ "$1" = normal ] || {
		# Create a null sink to easily run all audio through an equalizer
		pactl load-module module-null-sink object.linger=1 media.class=Audio/Sink sink_name=PreEqualizer \
			> "$log_dir/null-sink" 2>&1
		pactl set-default-sink PreEqualizer >> "$log_dir/null-sink" 2>&1

		# Create a null sink to easily noise suppress microphone output
		pactl load-module module-null-sink object.linger=1 media.class=Audio/Source/Virtual \
			sink_name=PostNoiseSuppression channels=1 > "$log_dir/null-source" 2>&1
		pactl set-default-source PostNoiseSuppression >> "$log_dir/null-source" 2>&1
	}
}
